#!/bin/bash

# Запрос параметров подключения к удаленному серверу
read -p "Введите удаленный сервер (user@hostname): " remote_server
read -p "Введите порог свободного места в процентах (например, 20): " threshold
read -p "Введите адрес электронной почты для уведомлений: " email

# Проверка свободного места на диске на удаленном сервере
available_space=$(ssh "$remote_server" "df -h --output=pcent / | tail -n 1 | tr -d ' %'")

if [ $? -ne 0 ]; then
  echo "Ошибка при подключении к удаленному серверу."
  exit 1
fi

echo "Свободное место на диске: $available_space%"

# Сравнение с порогом
if [ "$available_space" -ge "$threshold" ]; then
  echo "Свободное место на диске меньше порога ($threshold%). Отправка уведомления..."
  
  # Отправка уведомления по электронной почте
  echo "Внимание! На сервере $remote_server осталось только $available_space% свободного места." | mail -s "Уведомление о свободном месте на диске" "$email"
  
  if [ $? -eq 0 ]; then
    echo "Уведомление отправлено на $email."
  else
    echo "Ошибка при отправке уведомления."
  fi
else
  echo "Свободного места на диске достаточно."
fi

echo "Проверка завершена."
